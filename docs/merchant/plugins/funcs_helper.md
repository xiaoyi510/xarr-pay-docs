## helper

### 字符串和编码

#### helper.base64_encode
描述：将字符串进行base64编码

调用参数：
| 参数 | 参数类型            | 参数描述                           |
| ---- | ------------------- | ---------------------------------- |
| data | string/number/table | 要编码的数据，如果是表会先转为JSON |

返回值：
| 返回值类型 | 描述                 |
| ---------- | -------------------- |
| string     | base64编码后的字符串 |

#### helper.str_random
描述：生成指定长度的随机字符串

调用参数：
| 参数  | 参数类型 | 参数描述               |
| ----- | -------- | ---------------------- |
| count | number   | 要生成的随机字符串长度 |

返回值：
| 返回值类型 | 描述                 |
| ---------- | -------------------- |
| string     | 指定长度的随机字符串 |

#### helper.url_encode
描述：对字符串进行URL编码

调用参数：
| 参数 | 参数类型 | 参数描述            |
| ---- | -------- | ------------------- |
| str  | string   | 需要URL编码的字符串 |

返回值：
| 返回值类型 | 描述              |
| ---------- | ----------------- |
| string     | URL编码后的字符串 |

#### helper.url_decode
描述：对URL编码的字符串进行解码

调用参数：
| 参数 | 参数类型 | 参数描述        |
| ---- | -------- | --------------- |
| str  | string   | URL编码的字符串 |

返回值：
| 返回值类型 | 描述               |
| ---------- | ------------------ |
| string     | 解码后的原始字符串 |

#### helper.path_encode
描述：对路径进行编码

调用参数：
| 参数 | 参数类型 | 参数描述             |
| ---- | -------- | -------------------- |
| str  | string   | 需要编码的路径字符串 |

返回值：
| 返回值类型 | 描述               |
| ---------- | ------------------ |
| string     | 编码后的路径字符串 |

#### helper.path_decode
描述：对编码的路径进行解码

调用参数：
| 参数 | 参数类型 | 参数描述         |
| ---- | -------- | ---------------- |
| str  | string   | 编码的路径字符串 |

返回值：
| 返回值类型 | 描述                   |
| ---------- | ---------------------- |
| string     | 解码后的原始路径字符串 |

#### helper.md5
描述：计算字符串的MD5值

调用参数：
| 参数 | 参数类型 | 参数描述            |
| ---- | -------- | ------------------- |
| str  | string   | 需要计算MD5的字符串 |

返回值：
| 返回值类型 | 描述          |
| ---------- | ------------- |
| string     | 32位MD5哈希值 |

### 时间处理

#### helper.time_now_small_time
描述：获取当前无冒号的时间

调用参数：
| 参数      | 参数类型 | 参数描述                |
| --------- | -------- | ----------------------- |
| timestamp | int      | 时间戳,不传递为当前时间 |

返回值：
| 返回值类型 | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| string     | 格式化的时间字符串，格式为"yyyyMMddHHmmss" 如:20091227091010 |

#### helper.time_now_ymd_time
描述：获取当前日期，

调用参数：

| 参数      | 参数类型 | 参数描述                |
| --------- | -------- | ----------------------- |
| timestamp | int      | 时间戳,不传递为当前时间 |

返回值：
| 返回值类型 | 描述                                              |
| ---------- | ------------------------------------------------- |
| string     | 格式化的日期字符串，格式为"yyyyMMdd" 如: 20091227 |

#### helper.date
描述：根据指定格式获取时间字符串

调用参数：
| 参数      | 参数类型 | 参数描述                                                                      |
| --------- | -------- | ----------------------------------------------------------------------------- |
| format    | string   | 时间格式字符串,此处请注意,这里是按照golang的format格式,如:2006-01-02 15:04:05 |
| timestamp | int      | 时间戳                                                                        |

返回值：
| 返回值类型 | 描述                 |
| ---------- | -------------------- |
| string     | 格式化后的时间字符串 |

#### helper.time_now_datetime
描述：获取当前时间的标准格式字符串

调用参数：无

返回值：
| 返回值类型 | 描述                                                |
| ---------- | --------------------------------------------------- |
| string     | 格式化的日期时间字符串，格式为"2006-01-02 15:04:05" |

#### helper.time_now_timestamp
描述：获取当前时间戳

调用参数：无

返回值：
| 返回值类型 | 描述                   |
| ---------- | ---------------------- |
| number     | 当前的Unix时间戳（秒） |

#### helper.time_now_date
描述：获取当前日期时间

调用参数：无

返回值：
| 返回值类型 | 描述             |
| ---------- | ---------------- |
| table      | 当前日期时间对象 |

#### helper.datetime_to_timestamp
描述：将日期时间转换为时间戳

调用参数：
| 参数     | 参数类型 | 参数描述                                    |
| -------- | -------- | ------------------------------------------- |
| datetime | string   | 日期时间字符串，格式为"yyyy-MM-dd HH:mm:ss" |

返回值：
| 返回值类型 | 描述             |
| ---------- | ---------------- |
| number     | Unix时间戳（秒） |

### 金额转换

#### helper.amount_str2int
描述：将金额字符串转换为分（整数）

调用参数：
| 参数   | 参数类型 | 参数描述              |
| ------ | -------- | --------------------- |
| amount | string   | 金额字符串，如"12.34" |

返回值：
| 返回值类型 | 描述                       |
| ---------- | -------------------------- |
| number     | 金额的分值（整数），如1234 |

#### helper.amount_int2str
描述：将分（整数）转换为金额字符串

调用参数：
| 参数   | 参数类型 | 参数描述                   |
| ------ | -------- | -------------------------- |
| amount | number   | 金额的分值（整数），如1234 |

返回值：
| 返回值类型 | 描述                  |
| ---------- | --------------------- |
| string     | 金额字符串，如"12.34" |

### 数据格式转换

#### helper.xml_to_json
描述：将XML格式转换为JSON格式

调用参数：
| 参数 | 参数类型 | 参数描述        |
| ---- | -------- | --------------- |
| xml  | string   | XML格式的字符串 |

返回值：
| 返回值类型 | 描述               |
| ---------- | ------------------ |
| string     | 转换后的JSON字符串 |

### 正则表达式

#### helper.regexp_match
描述：使用正则表达式匹配字符串

调用参数：
| 参数    | 参数类型 | 参数描述       |
| ------- | -------- | -------------- |
| str     | string   | 要匹配的字符串 |
| pattern | string   | 正则表达式模式 |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 是否匹配成功 |

#### helper.regexp_match_group
描述：使用正则表达式匹配字符串并返回分组结果

调用参数：
| 参数    | 参数类型 | 参数描述                   |
| ------- | -------- | -------------------------- |
| str     | string   | 要匹配的字符串             |
| pattern | string   | 正则表达式模式（包含分组） |

返回值：
| 返回值类型 | 描述                                                 |
| ---------- | ---------------------------------------------------- |
| boolean    | 是否匹配成功                                         |
| string     | 匹配成功时返回分组结果的JSON字符串，失败返回空字符串 |

### RSA加密与验签

#### helper.rsa_private_sign_base64
描述：使用RSA私钥对内容进行签名并返回Base64编码结果

调用参数：
| 参数       | 参数类型 | 参数描述                  |
| ---------- | -------- | ------------------------- |
| content    | string   | 要签名的内容              |
| privateKey | string   | RSA私钥（不含头尾标识行） |
| unused     | string   | 未使用的参数              |

返回值：
| 返回值类型 | 描述                                       |
| ---------- | ------------------------------------------ |
| string     | Base64编码的签名结果，签名失败返回空字符串 |

#### helper.rsa_public_verify_sign_base64
描述：使用RSA公钥验证Base64编码的签名

调用参数：
| 参数      | 参数类型 | 参数描述                  |
| --------- | -------- | ------------------------- |
| content   | string   | 原始内容                  |
| sign      | string   | Base64编码的签名          |
| publicKey | string   | RSA公钥（不含头尾标识行） |
| unused    | string   | 未使用的参数              |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 验证是否成功 |


#### helper.rsa_gen_key_pair
描述: 生成RSA密钥对

调用参数：
| 参数      | 参数类型 | 参数描述                  |
| --------- | -------- | ------------------------- |
| bits   | number   | 密钥长度，可选，默认2048                  |
| algorithm      | string   | 签名算法，可选，可选值为RSA/RSA2/SM2(国密)，默认RSA2          |
| stripHeader | bool   | 是否去除PEM格式头尾，可选，默认true |
| stripNewlines    | bool   | 是否去除换行符，可选，默认true              |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 验证是否成功 |
| table    | 验证是否成功 |

table: 包含以下字段:
  - private_key: string，私钥，根据参数可能保留或去除PEM格式头尾和换行符
  - public_key: string，公钥，根据参数可能保留或去除PEM格式头尾和换行符
  - algorithm: string，使用的签名算法
  - bits: number，实际使用的密钥长度


### 配置管理

#### helper.get_plugin_option
描述：获取插件配置项

调用参数：
| 参数         | 参数类型 | 参数描述   |
| ------------ | -------- | ---------- |
| pluginName   | string   | 插件名称   |
| optionName   | string   | 配置项名称 |
| defaultValue | string   | 默认值     |

返回值：
| 返回值类型 | 描述                               |
| ---------- | ---------------------------------- |
| string     | 配置项的值，如果不存在则返回默认值 |

#### helper.set_plugin_option
描述：设置插件配置项

调用参数：
| 参数       | 参数类型 | 参数描述   |
| ---------- | -------- | ---------- |
| pluginName | string   | 插件名称   |
| optionName | string   | 配置项名称 |
| value      | string   | 配置项的值 |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 设置是否成功 |

#### helper.get_option
描述：获取配置项

调用参数：
| 参数 | 参数类型 | 参数描述     |
| ---- | -------- | ------------ |
| key  | string   | 配置项的键名 |

返回值：
| 返回值类型 | 描述       |
| ---------- | ---------- |
| string     | 配置项的值 |

#### helper.set_option
描述：设置配置项

调用参数：
| 参数  | 参数类型 | 参数描述     |
| ----- | -------- | ------------ |
| key   | string   | 配置项的键名 |
| value | string   | 配置项的值   |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 设置是否成功 |

### 通道账户管理

#### helper.channel_account_enable
描述：启用指定渠道账号

调用参数：
| 参数      | 参数类型 | 参数描述   |
| --------- | -------- | ---------- |
| accountId | int      | 渠道账号ID |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 是否启用成功 |

#### helper.channel_account_disable
描述：禁用指定渠道账号

调用参数：
| 参数      | 参数类型 | 参数描述   |
| --------- | -------- | ---------- |
| accountId | int      | 渠道账号ID |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 是否禁用成功 |

#### helper.channel_account_offline
描述：设置渠道账号为离线状态

调用参数：
| 参数      | 参数类型 | 参数描述   |
| --------- | -------- | ---------- |
| accountId | int      | 渠道账号ID |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 是否设置成功 |

#### helper.channel_account_online
描述：设置渠道账号为在线状态

调用参数：
| 参数      | 参数类型 | 参数描述   |
| --------- | -------- | ---------- |
| accountId | int      | 渠道账号ID |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 是否设置成功 |

#### helper.channel_account_set_option
描述：设置渠道账号的配置选项

调用参数：
| 参数      | 参数类型 | 参数描述   |
| --------- | -------- | ---------- |
| accountId | int      | 渠道账号ID |
| key       | string   | 配置项键名 |
| val       | string   | 配置项值   |

返回值：
| 返回值类型 | 描述         |
| ---------- | ------------ |
| boolean    | 是否设置成功 |

#### helper.channel_gateway_addr
描述：获取网关地址

调用参数：
| 参数      | 参数类型 | 参数描述 |
| --------- | -------- | -------- |
| gatewayId | string   | 网关ID   |

返回值：
| 返回值类型 | 描述                         |
| ---------- | ---------------------------- |
| string     | 网关地址，未找到返回空字符串 |

### 图像处理

#### helper.save_image_cache_base64
描述：保存Base64编码的图片到缓存目录

调用参数：
| 参数      | 参数类型 | 参数描述             |
| --------- | -------- | -------------------- |
| base64Str | string   | Base64编码的图片数据 |

返回值：
| 返回值类型 | 描述                                         |
| ---------- | -------------------------------------------- |
| boolean    | 是否保存成功                                 |
| string     | 保存成功返回图片的访问路径，失败返回空字符串 |

#### helper.url_parse
描述：解析URL字符串

调用参数：
| 参数 | 参数类型 | 参数描述          |
| ---- | -------- | ----------------- |
| uri  | string   | 要解析的URL字符串 |

返回值：
| 返回值类型 | 描述                                                     |
| ---------- | -------------------------------------------------------- |
| boolean    | 解析是否成功                                             |
| table      | 解析结果，包含scheme、host、path、query_str、query等字段 |

### HTTP请求

#### helper.http_request
描述：发送HTTP请求

调用参数：
| 参数    | 参数类型 | 参数描述                        |
| ------- | -------- | ------------------------------- |
| method  | string   | HTTP方法(GET, POST等)           |
| uri     | string   | 请求的URL地址                   |
| body    | string   | 请求体内容(GET请求可传空字符串) |
| headers | table    | 请求头，键值对格式(可传空表)    |

返回值：
| 返回值类型 | 描述                               |
| ---------- | ---------------------------------- |
| string     | 响应内容                           |
| number     | 错误码，0表示成功，502表示请求失败 |
